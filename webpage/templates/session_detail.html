{% extends "base.html" %}

{% block content %}
  <h1>Session Details</h1>
  <div class="card">
    <div class="card-body">
      <h2>{{ session.session_name }}</h2>
      <p><strong>Your tutor:</strong> {{ session.tutor_id.username }}</p>
      <p><strong>Category:</strong> {{ session.category }}</p>
      <p><strong>Description:</strong> {{ session.session_description }}</p>
      <p><strong>Start Date:</strong> {{ session.start_date }}</p>
      <p><strong>End Date:</strong> {{ session.end_date }}</p>
      <p><strong>Location:</strong> {{ session.location }}</p>
      <p><strong>Fee:</strong> {{ session.fee }}</p>
      <p><strong>Participants:</strong> {{ session.participants.count }} / {{ session.maximum_participant }}</p>
    </div>
  </div>

  <h3>Participants</h3>
  <ul>
    {% for participant in session.participants.all %}
      <li>{{ participant.username }}</li>
    {% empty %}
      <p>No participants yet.</p>
    {% endfor %}
  </ul>

    {% if request.user == session.tutor_id %}
        <h3>Applicants</h3>
          <ul>
    {% for applicant in session.applicants %}
  <div class="d-flex justify-content-start align-items-center mb-2">
    <p class="mb-0 mr-2">{{ applicant.username }}</p>
<form method="post" action="{% url 'accept-session' session.pk applicant.pk %}">
    {% csrf_token %}
    <button type="submit" class="btn btn-success mr-2">Accept</button>
</form>
    <form method="post" action="{% url 'cancel-session' session.pk applicant.pk %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-danger">Cancel</button>
    </form>
  </div>
{% empty %}
  <p>No applicants yet.</p>
{% endfor %}
  </ul>
  {% else %}
    {% if not request.user.is_authenticated %}
      <h5>Login to join any sessions</h5>
    {% elif request.user in session.participants.all %}
      <form method="post" action="{% url 'leave-session' session.pk %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-warning">Leave Session</button>
      </form>
    {% elif request.user in session.applicants %}
        <p>You have applied for this session and are pending approval.</p>
    {% elif not session.is_full %}
      <form method="post" action="{% url 'apply-session' session.pk %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary">Apply Session</button>
      </form>
    {% else %}
      <p>The session is full.</p>
    {% endif %}
  {% endif %}

  <a href="{% url 'session-list' %}" class="btn btn-primary mt-3">Back to Sessions</a>
{% endblock %}
